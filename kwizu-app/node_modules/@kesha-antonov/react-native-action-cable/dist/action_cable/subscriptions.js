var INTERNAL,Subscription,Subscriptions;INTERNAL=require("./internal").default,Subscription=require("./subscription").default;export default Subscriptions=class{constructor(i){this.create=this.create.bind(this),this.add=this.add.bind(this),this.remove=this.remove.bind(this),this.reject=this.reject.bind(this),this.forget=this.forget.bind(this),this.findAll=this.findAll.bind(this),this.reload=this.reload.bind(this),this.notifyAll=this.notifyAll.bind(this),this.notify=this.notify.bind(this),this.sendCommand=this.sendCommand.bind(this),this.consumer=i,this.subscriptions=[]}create(i){var t,s,n;return s="object"==typeof(t=i)?t:{channel:t},n=new Subscription(this.consumer,s),this.add(n)}add(i){return this.subscriptions.push(i),this.consumer.ensureActiveConnection(),this.notify(i,"initialized"),this.sendCommand(i,"subscribe"),i}remove(i){return this.forget(i),this.findAll(i.identifier).length||this.sendCommand(i,"unsubscribe"),i}reject(i){var t,s,n,r,e;for(r=[],t=0,s=(n=this.findAll(i)).length;t<s;t++)e=n[t],this.forget(e),this.notify(e,"rejected"),r.push(e);return r}forget(i){var t;return this.subscriptions=function(){var s,n,r,e;for(e=[],s=0,n=(r=this.subscriptions).length;s<n;s++)(t=r[s])!==i&&e.push(t);return e}.call(this),i}findAll(i){var t,s,n,r,e;for(r=[],t=0,s=(n=this.subscriptions).length;t<s;t++)(e=n[t]).identifier===i&&r.push(e);return r}reload(){var i,t,s,n,r;for(n=[],i=0,t=(s=this.subscriptions).length;i<t;i++)r=s[i],n.push(this.sendCommand(r,"subscribe"));return n}notifyAll(i,...t){var s,n,r,e,h;for(e=[],s=0,n=(r=this.subscriptions).length;s<n;s++)h=r[s],e.push(this.notify(h,i,...t));return e}notify(i,t,...s){var n,r,e,h;for(e=[],n=0,r=(h="string"==typeof i?this.findAll(i):[i]).length;n<r;n++)i=h[n],e.push("function"==typeof i[t]?i[t](...s):void 0);return e}sendCommand(i,t){var s;return({identifier:s}=i),this.consumer.send({command:t,identifier:s})}};